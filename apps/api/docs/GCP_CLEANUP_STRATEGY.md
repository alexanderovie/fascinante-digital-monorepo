# üéØ Estrategia Elite: Limpieza GCP Sin Perder Aprobaciones
## Octubre 2025 - Restructuraci√≥n Limpia

---

## üö® **LO QUE DEBES MANTENER (CR√çTICO)**

### **1. Aprobaciones de Google OAuth Consent Screen**
- ‚úÖ **Verificaci√≥n de dominio** (si aplica)
- ‚úÖ **Configuraci√≥n de OAuth consent screen**
- ‚úÖ **Scopes aprobados** (`business.manage`, etc.)
- ‚úÖ **Usuarios de prueba configurados**
- ‚úÖ **Verificaci√≥n de marca** (si existe)

**D√≥nde verificar:**
- Google Cloud Console ‚Üí APIs & Services ‚Üí OAuth consent screen
- **NO se pierde al limpiar APIs/Keys**

### **2. Verificaciones de Dominio**
- ‚úÖ Verificaci√≥n de propiedad de dominio
- ‚úÖ Configuraci√≥n de DNS/HTML
- ‚úÖ **NO se pierde** al limpiar recursos del proyecto

### **3. Facturaci√≥n Activo**
- ‚úÖ Billing account vinculado
- ‚úÖ **NO se pierde** al limpiar recursos

### **4. Proyecto y Permisos IAM**
- ‚úÖ El proyecto en s√≠ (no se puede perder)
- ‚úÖ Permisos de usuarios/SAs importantes

---

## üóëÔ∏è **LO QUE PUEDES LIMPIAR (Seguro)**

### **1. API Keys de Prueba**
- ‚ùå Puedes eliminar API Keys de prueba
- ‚úÖ Puedes crear nuevas despu√©s
- ‚ö†Ô∏è **NO afecta** OAuth consent screen

**Identificar de prueba:**
- Keys con nombres como: "test", "prueba", "dev", "demo"
- Keys antiguas no usadas
- Keys sin restricciones (menos seguras)

### **2. Service Accounts de Prueba**
- ‚ùå Puedes eliminar SAs de prueba
- ‚úÖ Puedes crear nuevos despu√©s
- ‚ö†Ô∏è **NO afecta** aprobaciones OAuth

**Identificar de prueba:**
- Nombres con "test", "dev", "prueba", "demo"
- SAs sin uso activo
- SAs con permisos excesivos

### **3. APIs Habilitadas Innecesarias**
- ‚ùå Puedes deshabilitar APIs de prueba
- ‚úÖ Puedes habilitarlas de nuevo cuando las necesites
- ‚ö†Ô∏è **NO afecta** aprobaciones OAuth

---

## üéØ **ESTRATEGIA ELITE: Limpieza Ordenada**

### **FASE 1: Auditor√≠a (Inventario Completo)**

#### **1.1 Documentar TODO antes de eliminar**

```bash
# Crear backup de configuraci√≥n actual
mkdir -p ~/gcp-backup-$(date +%Y%m%d)

# Exportar APIs habilitadas
gcloud services list --enabled \
  --project=fascinante-digit-1698295291643 \
  --format="json" > ~/gcp-backup-$(date +%Y%m%d)/apis-enabled.json

# Exportar API Keys
gcloud services api-keys list \
  --project=fascinante-digit-1698295291643 \
  --format="json" > ~/gcp-backup-$(date +%Y%m%d)/api-keys.json

# Exportar Service Accounts
gcloud iam service-accounts list \
  --project=fascinante-digit-1698295291643 \
  --format="json" > ~/gcp-backup-$(date +%Y%m%d)/service-accounts.json

# Exportar IAM policies
gcloud projects get-iam-policy fascinante-digit-1698295291643 \
  --format="json" > ~/gcp-backup-$(date +%Y%m%d)/iam-policy.json
```

#### **1.2 Identificar Recursos de Producci√≥n vs Prueba**

**Marcadores de "Producci√≥n":**
- ‚úÖ Nombres descriptivos profesionales
- ‚úÖ Restricciones de seguridad configuradas
- ‚úÖ √öltima modificaci√≥n reciente (en uso)
- ‚úÖ Relacionados con funcionalidades activas

**Marcadores de "Prueba":**
- ‚ùå Nombres con "test", "dev", "prueba", "demo", "trial"
- ‚ùå Sin restricciones de seguridad
- ‚ùå √öltima modificaci√≥n muy antigua
- ‚ùå Sin uso en c√≥digo actual

---

### **FASE 2: Limpieza Selectiva (Lo Seguro)**

#### **2.1 Limpiar API Keys de Prueba**

```bash
# Listar todas las keys
gcloud services api-keys list \
  --project=fascinante-digit-1698295291643 \
  --format="table(name,displayName,createTime)"

# Eliminar keys de prueba (EJEMPLO - ajustar nombres)
gcloud services api-keys delete KEY_ID \
  --project=fascinante-digit-1698295291643 \
  --quiet
```

**Keys a CONSERVAR:**
- ‚úÖ "Google Places API Key para Buscar Negocios" (producci√≥n)
- ‚úÖ Keys usadas en c√≥digo activo
- ‚úÖ Keys con restricciones de seguridad

**Keys a ELIMINAR:**
- ‚ùå "NEXT_PUBLIC_GOOGLE_MAPS_API_KEY" (si es duplicado/antigua)
- ‚ùå Keys sin uso en c√≥digo
- ‚ùå Keys de prueba obvias

#### **2.2 Limpiar Service Accounts de Prueba**

```bash
# Listar Service Accounts
gcloud iam service-accounts list \
  --project=fascinante-digit-1698295291643 \
  --format="table(email,displayName,createTime)"

# Eliminar SA de prueba (EJEMPLO)
gcloud iam service-accounts delete \
  SERVICE_ACCOUNT_EMAIL \
  --project=fascinante-digit-1698295291643 \
  --quiet
```

**SAs a CONSERVAR:**
- ‚úÖ `google-business-proxy@` (en uso)
- ‚úÖ `fascinante-2025-*` (estructura organizada)
- ‚úÖ SAs referenciados en c√≥digo

**SAs a ELIMINAR:**
- ‚ùå Solo si son claramente de prueba
- ‚ùå Si no se usan hace meses
- ‚ö†Ô∏è **CUIDADO:** Pueden tener keys/permisos importantes

#### **2.3 Deshabilitar APIs Innecesarias**

```bash
# Listar APIs habilitadas
gcloud services list --enabled \
  --project=fascinante-digit-1698295291643

# Deshabilitar APIs de prueba (si hay)
gcloud services disable SERVICE_NAME \
  --project=fascinante-digit-1698295291643 \
  --force  # Ignora dependencias
```

**APIs a CONSERVAR:**
- ‚úÖ Places API (producci√≥n)
- ‚úÖ Vertex AI (si la usas)
- ‚úÖ Business Profile APIs (si las usas)
- ‚úÖ APIs relacionadas con OAuth

---

### **FASE 3: Organizaci√≥n (Opcional pero Recomendado)**

#### **3.1 Etiquetar Recursos de Producci√≥n**

```bash
# Agregar labels al proyecto (si no tiene)
gcloud projects update fascinante-digit-1698295291643 \
  --labels=environment=production,purpose=production
```

#### **3.2 Renombrar Recursos Importantes**

```bash
# Renombrar API Key (si es necesario)
gcloud services api-keys update KEY_ID \
  --display-name="Places API - Production" \
  --project=fascinante-digit-1698295291643

# Actualizar descripci√≥n de Service Account
gcloud iam service-accounts update SERVICE_ACCOUNT_EMAIL \
  --description="Production service account for X" \
  --project=fascinante-digit-1698295291643
```

---

## üîí **VERIFICAR ANTES DE ELIMINAR**

### **Checklist Pre-Eliminaci√≥n:**

Antes de eliminar CUALQUIER recurso:

- [ ] ‚úÖ Verificar en c√≥digo si est√° en uso:
  ```bash
  grep -r "KEY_ID\|SERVICE_ACCOUNT" apps/
  ```

- [ ] ‚úÖ Verificar en variables de entorno:
  ```bash
  grep -r "KEY\|SERVICE_ACCOUNT" .env* apps/api/.dev.vars
  ```

- [ ] ‚úÖ Verificar en Cloudflare Workers secrets:
  ```bash
  wrangler secret list
  ```

- [ ] ‚úÖ Verificar √∫ltimos logs de uso (Cloud Console)

---

## üéØ **ALTERNATIVA: CREAR NUEVO PROYECTO**

### **Si quieres empezar COMPLETAMENTE limpio:**

#### **Opci√≥n A: Proyecto Nuevo + Migrar Aprobaciones**

1. **Crear proyecto nuevo:**
   ```bash
   gcloud projects create fascinante-digit-2025 \
     --name="Fascinante Digital 2025"
   ```

2. **Migrar OAuth Consent Screen:**
   - ‚ùå **NO se puede migrar directamente**
   - ‚úÖ Debes reconfigurar en el nuevo proyecto
   - ‚ö†Ô∏è **Requiere nueva verificaci√≥n** de dominio
   - ‚ö†Ô∏è **Requiere nueva revisi√≥n** de Google (si es necesario)

3. **Migrar dominios verificados:**
   - ‚ö†Ô∏è Debes reverificar en el nuevo proyecto
   - ‚ö†Ô∏è Puede requerir cambios de DNS

#### **Opci√≥n B: Limpieza Selectiva (RECOMENDADA)**

- ‚úÖ Mantienes el proyecto existente
- ‚úÖ Mantienes todas las aprobaciones
- ‚úÖ Solo limpias recursos innecesarios
- ‚úÖ Empiezas limpio en organizaci√≥n

---

## üìã **PLAN DE ACCI√ìN RECOMENDADO**

### **Paso 1: Backup Completo**
```bash
# Ejecutar comandos de FASE 1
# Guardar backups en lugar seguro
```

### **Paso 2: An√°lisis**
- Revisar backups
- Identificar qu√© es producci√≥n vs prueba
- Marcar recursos a eliminar

### **Paso 3: Limpieza Gradual**
- Empezar con recursos obviamente de prueba
- Verificar que nada se rompe
- Continuar gradualmente

### **Paso 4: Organizaci√≥n**
- Renombrar recursos importantes
- Agregar descripciones
- Documentar estructura

---

## ‚úÖ **LO QUE NO SE PIERDE**

### **Al Limpiar APIs/Keys/SAs:**

‚úÖ **SE MANTIENE:**
- OAuth Consent Screen configuration
- Dominios verificados
- Facturaci√≥n
- Permisos IAM de usuarios
- Historial de facturaci√≥n
- Logs hist√≥ricos

‚ùå **SE PIERDE (pero recuperable):**
- API Keys eliminadas (deben recrearse)
- Service Accounts eliminados (deben recrearse)
- APIs deshabilitadas (pueden re-habilitarse)

---

## üéØ **RECOMENDACI√ìN FINAL**

### **Estrategia Elite Recomendada:**

1. ‚úÖ **NO crear nuevo proyecto** (pierdes aprobaciones)
2. ‚úÖ **Hacer backup completo** primero
3. ‚úÖ **Limpiar gradualmente** (no todo de una vez)
4. ‚úÖ **Mantener estructura organizada** (`fascinante-2025-*`)
5. ‚úÖ **Eliminar solo lo obviamente de prueba**
6. ‚úÖ **Renombrar lo importante** con naming consistente
7. ‚úÖ **Documentar estructura final**

### **Orden de Limpieza Seguro:**

1. APIs habilitadas innecesarias (f√°cil de revertir)
2. API Keys obviamente de prueba
3. Service Accounts sin uso
4. Keys/SAs antiguos sin restricciones

---

## üîç **SCRIPTS √öTILES**

### **Script de Auditor√≠a Pre-Limpieza**

```bash
#!/bin/bash
# audits/gcp-audit.sh

PROJECT="fascinante-digit-1698295291643"
BACKUP_DIR="~/gcp-audit-$(date +%Y%m%d)"

mkdir -p "$BACKUP_DIR"

echo "üîç Auditor√≠a GCP - $PROJECT"

# APIs
gcloud services list --enabled \
  --project=$PROJECT \
  --format="json" > "$BACKUP_DIR/apis.json"

# API Keys
gcloud services api-keys list \
  --project=$PROJECT \
  --format="json" > "$BACKUP_DIR/api-keys.json"

# Service Accounts
gcloud iam service-accounts list \
  --project=$PROJECT \
  --format="json" > "$BACKUP_DIR/service-accounts.json"

# IAM
gcloud projects get-iam-policy $PROJECT \
  --format="json" > "$BACKUP_DIR/iam.json"

echo "‚úÖ Backup guardado en: $BACKUP_DIR"
```

---

## ‚ö†Ô∏è **ADVERTENCIAS IMPORTANTES**

1. **OAuth Consent Screen:**
   - Est√° vinculado al proyecto
   - NO se puede migrar f√°cilmente
   - Si creas proyecto nuevo, debes reconfigurar desde cero

2. **Verificaci√≥n de Dominio:**
   - Tambi√©n vinculada al proyecto
   - Requiere reverificaci√≥n en proyecto nuevo

3. **Historial y Logs:**
   - Se pierden al cambiar de proyecto
   - Mejor mantener proyecto existente

---

## üí° **FEEDBACK FINAL**

### **‚úÖ Lo que DEBES hacer:**

1. ‚úÖ **Backup completo** antes de cualquier eliminaci√≥n
2. ‚úÖ **Auditar** qu√© recursos est√°n en uso
3. ‚úÖ **Limpiar gradualmente** (no todo de golpe)
4. ‚úÖ **Mantener el proyecto** (no crear uno nuevo)
5. ‚úÖ **Documentar** qu√© eliminas y por qu√©

### **‚ùå Lo que NO debes hacer:**

1. ‚ùå **Eliminar todo de una vez**
2. ‚ùå **Crear proyecto nuevo** (pierdes aprobaciones)
3. ‚ùå **Eliminar sin verificar uso en c√≥digo**
4. ‚ùå **Limpiar sin backup**

---

## üéØ **PR√ìXIMOS PASOS SUGERIDOS**

1. Ejecutar script de auditor√≠a
2. Revisar backups identificando producci√≥n vs prueba
3. Crear lista de recursos a eliminar
4. Verificar uso en c√≥digo
5. Eliminar gradualmente
6. Documentar estructura final

---

**√öltima actualizaci√≥n:** Octubre 2025
**Recomendaci√≥n:** ‚úÖ Limpieza selectiva, NO proyecto nuevo
